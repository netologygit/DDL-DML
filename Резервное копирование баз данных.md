«Резервное копирование баз данных» - Игуменова Екатерина

***Задание 1. Резервное копирование***

1.1. Для того, чтобы восстановить полностью данные за предыдущий день, нам необходимо, чтобы у нас был FULL-бэкап, а также DIFF-бэкап. К примеру, фуловый бэкап будет делаться раз в неделю, а дифференциальный бэкап будет выполняться раз в сутки, привязываясь к последнему фулл бэкапу. DIFF backup является накопительным, т.е. каждая следующая копия содержит все новые/измененные файлы с момента создания предыдущей
полной резервной копии. Для восстановления файлов потребуется последний созданный полный бэкап и последний дифференциальный

1.2. Нам необходимо иметь фул-бэкап и инкрементальный бэкап, так как инкрементное резервное копирование использует полную копию, как начальную точку. Необходимо, чтобы инкрементальный бэкап был настроен  раз в час. Таким образом нам необходимо будет восстановить фул бэкап, и инкрементальными бэкапами восстановить данные на нужное время.

1.3. Для того, чтобы моментально переключить на работающую БД, нам необходимо чтобы была настроена репликация, т е имелся сервер slave. Если репликаия синхронная, то данные будут полностью консистентны, т к при синхронной репликации commit на мастере происхордит после применения изменений на реплике. При асинхронной репликациии возможны небольшие потери. Идеальный вариант - наличие синхронной и асинхронной реплики. 

***Задание 2. PostgreSQL***

Данная утилита имеет множество опций и аргументов, каждая из них используется в зависимости от поставленной задачи
pg_dump — извлекает базу данных PostgreSQL в файл сценария или другой архивный файл
pg_dump [connection-option...] [option...] [dbname]

Для сброса вызванной базы данных mydb в файл SQL-скрипта:
$ pg_dump mydb > db.sql

Для перезагрузки такого скрипта в (только что созданную) базу данных с именем newdb:
$ psql -d newdb -f db.sql

Для выгрузки базы данных в архивный файл пользовательского формата:
$ pg_dump -Fc mydb > db.dump

Для выгрузки базы данных в архив в формате каталога:
$ pg_dump -Fd mydb -f dumpdir

Для сброса всех баз данных:
$ pg_dumpall > db.out

pg_restore — восстановление базы данных PostgreSQL из архивного файла, созданного с помощью pg_dump
pg_restore [connection-option...] [option...] [filename]

Предположим, что мы выгрузили вызванную базу данных mydb в файл дампа пользовательского формата:

$ pg_dump -Fc mydb > db.dump
Удалить базу данных и воссоздать ее из дампа:

$ dropdb mydb
$ pg_restore -C -d postgres db.dump
Базой данных, указанной в -d переключателе, может быть любая база данных, существующая в кластере; pg_restore использует ее только для выдачи CREATE DATABASE команды для mydb. С помощью -C данные всегда восстанавливаются в имя базы данных, которое отображается в файле дампа.

Для восстановления дампа в новую базу данных под названием newdb:
$ createdb -T template0 newdb
$ pg_restore -d newdb db.dump

***Задание 3. MySQL***

Инкрементная резервная копия включается с помощью одной из двух опций: --incremental и --incremental-with-redo-log-only option.
Для MySQL Enterprise Backup 8.0.20 и более ранних версий: Чтобы восстановить инкрементную резервную копию, укажите --incremental опцию (опция больше не требуется для MySQL Enterprise Backup 8.0.21 и более поздних версий для операций восстановления).

--incremental[={page-track|full-scan|optimistic}]

--incremental-with-redo-log-only указывает, что инкрементная резервная копия должна быть создана с использованием только журнала повторов. Этот альтернативный тип инкрементного резервного копирования отличается характеристиками производительности и эксплуатационными ограничениями по сравнению с резервными копиями, созданными с помощью --incremental . Также важно помнить, что нельзя  использовать --compress опцию вместе с --incremental-with-redo-log-only опцией.

--incremental-backup-dir=PATH дополнительно: указывает местоположение для данных инкрементной резервной копии каталога. 

mysqlbackup --defaults-file=/home/dbadmin/my.cnf --incremental \
 --incremental-base=dir:/incr-backup/wednesday \
 --incremental-backup-dir=/incr-backup/thursday \
 backup
